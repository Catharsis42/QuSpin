
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" /><script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-110543543-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Direct Calculation of spectral functions using symmetries &#8212; QuSpin 0.3.7 documentation</title>
    <link rel="stylesheet" href="../static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
    <script src="../static/jquery.js"></script>
    <script src="../static/underscore.js"></script>
    <script src="../static/doctools.js"></script>
    <script src="../static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">QuSpin 0.3.7 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <style> .red {color:#ff0000; font-weight:bold; font-style:italic; } </style>
<style> .green {color:#00b200; font-weight:bold; font-style:italic; } </style>
<style> .magenta {color:#FF33F3; font-weight:bold; font-style:italic; } </style>
<style> .orange {color:#FE8E02; font-weight:bold; font-style:italic; } </style><div class="section" id="direct-calculation-of-spectral-functions-using-symmetries">
<span id="example26-label"></span><h1>Direct Calculation of spectral functions using symmetries<a class="headerlink" href="#direct-calculation-of-spectral-functions-using-symmetries" title="Permalink to this headline">¶</a></h1>
<p>This example demonstrates how to use the general basis function method <cite>Op_shift_sector()</cite> to compute spectral functions directly without Fourier -transforming auto-correlation functions. The idea here is to use SciPy’s iterative solvers for sparse linear systems to calculate the action of an inverted operator on a state.</p>
<p>The spectral function in ground state <span class="math notranslate nohighlight">\(|0\rangle\)</span> can be written as:</p>
<div class="math notranslate nohighlight">
\[C(\omega) = -\frac{1}{\pi}\langle 0|A^\dagger\frac{1}{\omega+i\eta + E_0 - H} A|0\rangle,\]</div>
<p>where <span class="math notranslate nohighlight">\(\eta\)</span> is the boradening factor for the spectral peaks. For an operator <span class="math notranslate nohighlight">\(A\)</span> that has quantum numbers that differ from the ground state <span class="math notranslate nohighlight">\(|0\rangle\)</span> we can use <cite>Op_shift_sector()</cite> to calculate the a new ket: <span class="math notranslate nohighlight">\(|A\rangle = A|0\rangle\)</span>. With this new ket, we can construct the Hamiltonian <span class="math notranslate nohighlight">\(H\)</span> in the new sector, and solve the following equation:</p>
<div class="math notranslate nohighlight">
\[(\omega+i\eta + E_0 - H)|x(\omega)\rangle = |A\rangle.\]</div>
<p>This equation can be solved using the bi-conjugate gradient (cf. <cite>scipy.sparse.linalg.bicg</cite>) method that is implemented in SciPy. In order to solve that equation with SciPy we define a custom class (see code below) that produces the action <span class="math notranslate nohighlight">\((\omega \pm i\eta + E_0 - H)|u\rangle\)</span> for an arbitrary state <span class="math notranslate nohighlight">\(|u\rangle\)</span>. Now we can use <span class="math notranslate nohighlight">\(|x(\omega)\rangle\)</span> to calculate the spectral function a given value of <span class="math notranslate nohighlight">\(\omega\)</span> as follows:</p>
<div class="math notranslate nohighlight">
\[C(\omega) = -\frac{1}{\pi}\langle A|x(\omega)\rangle.\]</div>
<p>Note that this method can also be used to calculate spectral functions for any state by replacing <span class="math notranslate nohighlight">\(|0\rangle\rightarrow|\psi\rangle\)</span>. This may be useful for calculating spectral functions away from equilibrium by using <span class="math notranslate nohighlight">\(|\psi(t)\rangle\)</span> that has undergone some kind of time evolution (in the Schrödinger picture).</p>
<p>In the example below, we look at the Heisenberg chain (<span class="math notranslate nohighlight">\(J=1\)</span>) with periodic boundary conditions. The periodic boundary condition allows us to use translation symmetry to reduce the total Hilbert space into blocks labeled by the many-body momentum quantum number. We limit the chain lengths to <span class="math notranslate nohighlight">\(L=4n\)</span> for <span class="math notranslate nohighlight">\(n=1,2,3...\)</span>, since this is required to have the ground state in the zero-momentum sector (for other system sizes, the ground state of the isotropic Heisenberg chain has finite momentum).</p>
<p>Below, we calculate two different spectral functions:</p>
<div class="math notranslate nohighlight">
\[G_{zz}(\omega,q) = \langle 0|S^{z}_{-q}\frac{1}{\omega+i\eta + E_0 - H}S^{z}_q|0\rangle\]</div>
<div class="math notranslate nohighlight">
\[G_{+-}(\omega,q) = \langle 0|S^{-}_{-q}\frac{1}{\omega+i\eta + E_0 - H}S^{+}_q|0\rangle\]</div>
<p>where we have defined:</p>
<div class="math notranslate nohighlight">
\[S^{z}_q = \frac{1}{\sqrt{L}}\sum_{r=0}^{L-1} \exp\left(-i\frac{2\pi q r}{L}\right) S^z_r\]</div>
<div class="math notranslate nohighlight">
\[S^{\pm}_q = \frac{1}{\sqrt{2L}}\sum_{r=0}^{L-1} \exp\left(-i\frac{2\pi q r}{L}\right) S^{\pm}_r\]</div>
<p>Because the model has full SU(2) symmetry, we expect that the two spectral functions should give the same result. We also exclude the spectral function for <span class="math notranslate nohighlight">\(q=L/2\)</span> (<span class="math notranslate nohighlight">\(\pi\)</span>-momentum) as the spectral peak is very large due to the quasi long-range antiferromagnetic order in the ground state. The variable <cite>on_the_fly</cite> can be used to switch between using a <cite>hamiltonian</cite> object to a <cite>quantum_LinearOperator</cite> object to calculate the matrix vector product. One can also change the total spin of the local spin operators by changing the variable <cite>S</cite> to compute the spectral function for higher-spin Heisenberg models.</p>
</div>
<div class="section" id="script">
<h1>Script<a class="headerlink" href="#script" title="Permalink to this headline">¶</a></h1>
<p><a class="reference download internal" download="" href="../downloads/a241ba4b76a2f615b46b018d538df8e3/example26.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;KMP_DUPLICATE_LIB_OK&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;True&#39;</span> <span class="c1"># uncomment this line if omp error occurs on OSX for python 3</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span> <span class="c1"># set number of OpenMP threads to run in parallel</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MKL_NUM_THREADS&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span> <span class="c1"># set number of MKL threads to run in parallel</span>
<span class="c1">#</span>
<span class="n">quspin_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s2">&quot;../../&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">quspin_path</span><span class="p">)</span>
<span class="c1">#######################################################################</span>
<span class="c1">#                            example 26                               #</span>
<span class="c1"># This example shows how to use the `Op-shit_sector` method of the    #</span>
<span class="c1"># general basis class to compute spectral functions using symmetries. #</span>
<span class="c1">#######################################################################</span>
<span class="kn">from</span> <span class="nn">quspin.basis</span> <span class="kn">import</span> <span class="n">spin_basis_general</span>
<span class="kn">from</span> <span class="nn">quspin.operators</span> <span class="kn">import</span> <span class="n">hamiltonian</span><span class="p">,</span><span class="n">quantum_LinearOperator</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numexpr</span><span class="o">,</span><span class="nn">cProfile</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># define custom LinearOperator object that generates the left hand side of the equation.</span>
<span class="c1">#</span>
<span class="k">class</span> <span class="nc">LHS</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinearOperator</span><span class="p">):</span>
	<span class="c1">#</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">omega</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">E0</span><span class="p">,</span><span class="n">kwargs</span><span class="o">=</span><span class="p">{}):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_H</span> <span class="o">=</span> <span class="n">H</span> <span class="c1"># Hamiltonian</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">eta</span> <span class="o">+</span> <span class="n">E0</span> <span class="c1"># complex energy</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span> <span class="c1"># arguments</span>
	<span class="c1">#</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_H</span><span class="o">.</span><span class="n">Ns</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_H</span><span class="o">.</span><span class="n">Ns</span><span class="p">)</span>
	<span class="c1">#</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_H</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
	<span class="c1">#</span>
	<span class="k">def</span> <span class="nf">_matvec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
		<span class="c1"># left multiplication</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">*</span> <span class="n">v</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_H</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">)</span>
	<span class="c1">#</span>
	<span class="k">def</span> <span class="nf">_rmatvec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
		<span class="c1"># right multiplication</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">v</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_H</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">##### calculate action without constructing the Hamiltonian matrix</span>
<span class="c1">#</span>
<span class="n">on_the_fly</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># toggles between using a `hamiltnian` or a `quantum_LinearOperator` object</span>
<span class="c1"># chain length</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">12</span>
<span class="c1"># on-site spin size </span>
<span class="n">S</span> <span class="o">=</span> <span class="s2">&quot;1/2&quot;</span>
<span class="c1"># translation transformation on the lattice sites [0,...,L-1]</span>
<span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">L</span>
<span class="c1"># this example does not work under these conditions because ground-state sector is not q=0</span>
<span class="k">if</span> <span class="p">(</span><span class="n">L</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
	<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Example requires modifications for Heisenberg chains with L=4*n+2.&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">L</span><span class="o">%</span><span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
	<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Example requires modifications for Heisenberg chains with odd number of sites.&quot;</span><span class="p">)</span>
<span class="c1"># construct basis</span>
<span class="n">basis0</span> <span class="o">=</span> <span class="n">spin_basis_general</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">pauli</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">kblock</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="c1"># construct static list for Heisenberg chain</span>
<span class="n">Jzz_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="n">i</span><span class="p">,(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">L</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>
<span class="n">Jxy_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span><span class="n">i</span><span class="p">,(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">L</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>
<span class="n">static</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;zz&quot;</span><span class="p">,</span><span class="n">Jzz_list</span><span class="p">],[</span><span class="s2">&quot;+-&quot;</span><span class="p">,</span><span class="n">Jxy_list</span><span class="p">],[</span><span class="s2">&quot;-+&quot;</span><span class="p">,</span><span class="n">Jxy_list</span><span class="p">]]</span>
<span class="c1"># construct operator for Hamiltonian in the ground state sector</span>
<span class="k">if</span> <span class="n">on_the_fly</span><span class="p">:</span>
	<span class="n">H0</span> <span class="o">=</span> <span class="n">quantum_LinearOperator</span><span class="p">(</span><span class="n">static</span><span class="p">,</span><span class="n">basis</span><span class="o">=</span><span class="n">basis0</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="n">H0</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">static</span><span class="p">,[],</span><span class="n">basis</span><span class="o">=</span><span class="n">basis0</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="c1"># calculate ground state</span>
<span class="p">[</span><span class="n">E0</span><span class="p">],</span><span class="n">psi0</span> <span class="o">=</span> <span class="n">H0</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;SA&quot;</span><span class="p">)</span>
<span class="n">psi0</span> <span class="o">=</span> <span class="n">psi0</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="c1"># define all possible momentum sectors excluding q=L/2 (pi-momentum) where the peak is abnormally large</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">L</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">L</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># define frequencies to calculate spectral function for</span>
<span class="n">omegas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
<span class="c1"># spectral peaks broadening factor</span>
<span class="n">eta</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="c1"># allocate arrays to store data</span>
<span class="n">Gzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">omegas</span><span class="o">.</span><span class="n">shape</span><span class="o">+</span><span class="n">qs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
<span class="n">Gpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">omegas</span><span class="o">.</span><span class="n">shape</span><span class="o">+</span><span class="n">qs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
<span class="c1"># loop over momentum sectors</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qs</span><span class="p">):</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;computing momentum block q=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">)</span>
	<span class="c1"># define block</span>
	<span class="n">block</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">qblock</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
	<span class="c1">#</span>
	<span class="c1">####################################################################</span>
	<span class="c1">#</span>
	<span class="c1"># ---------------------------------------------------- #</span>
	<span class="c1">#                 calculation but for SzSz             #</span>
	<span class="c1"># ---------------------------------------------------- #</span>
	<span class="c1">#</span>
	<span class="c1"># define operator list for Op_shift_sector</span>
	<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
	<span class="n">Op_list</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;z&quot;</span><span class="p">,[</span><span class="n">i</span><span class="p">],</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>
	<span class="c1"># define basis</span>
	<span class="n">basisq</span> <span class="o">=</span> <span class="n">spin_basis_general</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">pauli</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">block</span><span class="p">)</span>
	<span class="c1"># define operators in the q-momentum sector</span>
	<span class="k">if</span> <span class="n">on_the_fly</span><span class="p">:</span>
		<span class="n">Hq</span> <span class="o">=</span> <span class="n">quantum_LinearOperator</span><span class="p">(</span><span class="n">static</span><span class="p">,</span><span class="n">basis</span><span class="o">=</span><span class="n">basisq</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
			<span class="n">check_symm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_pcon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_herm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">Hq</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">static</span><span class="p">,[],</span><span class="n">basis</span><span class="o">=</span><span class="n">basisq</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
			<span class="n">check_symm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_pcon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_herm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="c1"># shift sectors</span>
	<span class="n">psiA</span> <span class="o">=</span> <span class="n">basisq</span><span class="o">.</span><span class="n">Op_shift_sector</span><span class="p">(</span><span class="n">basis0</span><span class="p">,</span><span class="n">Op_list</span><span class="p">,</span><span class="n">psi0</span><span class="p">)</span>
	<span class="c1">#</span>
	<span class="c1">### apply vector correction method</span>
	<span class="c1">#</span>
	<span class="c1"># solve (z-H)|x&gt; = |A&gt; solve for |x&gt;  using iterative solver for each omega</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">omega</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">omegas</span><span class="p">):</span>
		<span class="n">lhs</span> <span class="o">=</span> <span class="n">LHS</span><span class="p">(</span><span class="n">Hq</span><span class="p">,</span><span class="n">omega</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">E0</span><span class="p">)</span>
		<span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">bicg</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span><span class="n">psiA</span><span class="p">)</span>
		<span class="n">Gzz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">psiA</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
	<span class="c1">#</span>
	<span class="c1">#####################################################################</span>
	<span class="c1">#</span>
	<span class="c1"># ---------------------------------------------------- #</span>
	<span class="c1">#            same calculation but for S-S+             #</span>
	<span class="c1"># ---------------------------------------------------- #</span>
	<span class="c1">#</span>
	<span class="c1"># divide by extra sqrt(2) to get extra factor of 1/2 when taking sandwich: needed since H = 1/2 (S^+_i S^-_j + h.c.) + S^z_j S^z_j</span>
	<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">))</span>
	<span class="n">Op_list</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;+&quot;</span><span class="p">,[</span><span class="n">i</span><span class="p">],</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>
	<span class="c1"># change S_z projection up by S for action of S+ operator</span>
	<span class="n">S_z_tot</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="nb">eval</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
	<span class="c1"># calculate magnetization density from S_z_tot as defined in the documentation</span>
	<span class="c1"># m = S_z_tot / (S * N), S: local spin (as number), N: total spins</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">S_z_tot</span><span class="o">/</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="o">*</span><span class="n">L</span><span class="p">)</span> 
	<span class="n">basisq</span> <span class="o">=</span> <span class="n">spin_basis_general</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="n">pauli</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">block</span><span class="p">)</span>
	<span class="c1"># define operators in the q-momentum sector</span>
	<span class="k">if</span> <span class="n">on_the_fly</span><span class="p">:</span>
		<span class="n">Hq</span> <span class="o">=</span> <span class="n">quantum_LinearOperator</span><span class="p">(</span><span class="n">static</span><span class="p">,</span><span class="n">basis</span><span class="o">=</span><span class="n">basisq</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
			<span class="n">check_symm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_pcon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_herm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">Hq</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">static</span><span class="p">,[],</span><span class="n">basis</span><span class="o">=</span><span class="n">basisq</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
			<span class="n">check_symm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_pcon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">check_herm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="c1"># shift sectors</span>
	<span class="n">psiA</span> <span class="o">=</span> <span class="n">basisq</span><span class="o">.</span><span class="n">Op_shift_sector</span><span class="p">(</span><span class="n">basis0</span><span class="p">,</span><span class="n">Op_list</span><span class="p">,</span><span class="n">psi0</span><span class="p">)</span>
	<span class="c1">#</span>
	<span class="c1">### apply vector correction method</span>
	<span class="c1">#</span>
	<span class="c1"># solve (z-H)|x&gt; = |A&gt; solve for |x&gt;  using iterative solver for each omega</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">omega</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">omegas</span><span class="p">):</span>
		<span class="n">lhs</span> <span class="o">=</span> <span class="n">LHS</span><span class="p">(</span><span class="n">Hq</span><span class="p">,</span><span class="n">omega</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">E0</span><span class="p">)</span>
		<span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">bicg</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span><span class="n">psiA</span><span class="p">)</span>
		<span class="n">Gpm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">psiA</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="c1">#</span>
<span class="c1">##### plot results</span>
<span class="c1">#</span>
<span class="n">ks</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">qs</span><span class="o">/</span><span class="n">L</span> <span class="c1"># compute physical momentum values</span>
<span class="n">f</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span><span class="n">omegas</span><span class="p">,</span><span class="n">Gzz</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span><span class="n">omegas</span><span class="p">,</span><span class="n">Gpm</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$k$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">omega$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">omega$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$G_</span><span class="si">{zz}</span><span class="s1">(</span><span class="se">\\</span><span class="s1">omega,k)$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$G_{+-}(</span><span class="se">\\</span><span class="s1">omega,k)$&#39;</span><span class="p">)</span>
<span class="c1">#plt.show()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Direct Calculation of spectral functions using symmetries</a></li>
<li><a class="reference internal" href="#script">Script</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../sources/examples/example26.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">QuSpin 0.3.7 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Phillip Weinberg, Markus Schmitt and Marin Bukov.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.
    </div>
  </body>
</html>